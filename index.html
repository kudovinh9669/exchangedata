<!DOCTYPE html>
<html lang="vi">
<head>
<link rel="icon" type="image/png" href="icon.png" sizes="48x48">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toolkit Exchange v2</title>
<style>
  :root{
    --bg:#0b1220; --panel:#101a2b; --text:#e7edf7; --muted:#97a4be;
    --acc:#14b8a6; --acc-2:#60a5fa; --border:#20304b;
    --btn:#1f2a44; --btn-h:#273352;
    --warn:#f59e0b; --ok:#22c55e; --bad:#ef4444;
  }
  .light{
    --bg:#f6f8fc; --panel:#ffffff; --text:#0b1220; --muted:#44506a;
    --acc:#0ea5e9; --acc-2:#16a34a; --border:#e5e9f2;
    --btn:#eef2f9; --btn-h:#e4e9f5;
  }
 /* webkit scrollbar */
*::-webkit-scrollbar{height:10px;width:10px}
*::-webkit-scrollbar-track{background:var(--btn);border-radius:8px}
*::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(14,165,233,.9),rgba(14,165,233,.7));border:2px solid var(--btn);border-radius:8px}
*::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,rgba(14,165,233,1),rgba(14,165,233,.85))}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
  .frame{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:visible;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .frame-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
  .brand{display:flex;align-items:center;gap:10px}
  .brand h1{font-size:18px;letter-spacing:.2px;margin:0}
  .muted{color:var(--muted)}
  .theme-btn{appearance:none;border:1px solid var(--border);background:var(--btn);color:var(--text);padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px}
  .theme-btn:hover{background:var(--btn-h)}
  .theme-ico{width:18px;height:18px;display:inline-grid;place-items:center}
  .tabs{display:flex;gap:8px;padding:8px;border-bottom:1px solid var(--border);overflow-x:auto}
  .tab-btn{background:transparent;border:1px solid transparent;color:var(--muted);padding:8px 12px;border-radius:9px;cursor:pointer;white-space:nowrap}
  .tab-btn:hover{color:var(--text)}
  .tab-btn.active{color:var(--text);border-color:var(--border);background:rgba(96,165,250,.08)}
  .panel{padding:18px}
  .grid{display:grid;gap:16px}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  .card{border:1px solid var(--border);border-radius:12px;padding:16px;overflow:visible}
  .title{display:flex;align-items:center;gap:10px;margin:6px 0 12px}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--acc)}
  .row{display:flex;flex-wrap:wrap;gap:12px;align-items:end}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="number"],select,input[type="date"],textarea{
    width:100%;min-width:140px;max-width:260px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);
    background:transparent;color:var(--text);outline:none
  }
  textarea{min-height:84px;max-width:520px}
  select,option{background-color:var(--panel);color:var(--text)}
  select:focus,input:focus,textarea:focus{outline:2px solid var(--acc-2);outline-offset:1px}
  input[type="checkbox"]{width:18px;height:18px}
  .btn{background:var(--acc);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn:hover{filter:brightness(1.05)}
  .icon-btn{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;border:1px solid var(--border);background:transparent;cursor:pointer}
  .icon-btn:hover{background:var(--btn-h)}
  .result{margin-top:10px;padding:12px;border:1px dashed var(--border);border-radius:10px}
  .foot{padding:14px;border-top:1px dashed var(--border);text-align:center;color:var(--muted);font-size:13px}
  .status{font-size:13px;color:var(--muted)}
  .radio-row{display:flex;gap:14px;align-items:center}
  .hist{margin-top:10px}
  .hist b{font-size:13px;color:var(--muted)}
  .hist ul{margin:6px 0 0 18px;padding:0}
  .hist li{font-size:13px;color:var(--muted)}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid var(--border);padding:8px;text-align:right}
  th{background:rgba(255,255,255,.04);text-align:center}
  .warn{color:var(--warn)} .ok{color:var(--ok)} .bad{color:var(--bad)}
  .section-sep{
  border:none;
  border-top:1px solid var(--bd);
  margin:16px 0;
}
.tab-panel .box{display:block;} /* ƒë·∫£m b·∫£o block chi·∫øm ƒë·ªß h√†ng */
.section-sep{border:none;border-top:1px solid var(--bd);margin:16px 0}
  /* Icon tr∆∞·ªõc t√™n tab (√°p d·ª•ng cho .tab-btn) */
.tabs .tab-btn{display:inline-flex;align-items:center;gap:8px}
.tabs .tab-btn .ico{display:inline-flex;width:18px;height:18px;opacity:.9}
.tabs .tab-btn .ico svg{width:18px;height:18px;display:block}
.tabs .tab-btn:hover { background: rgba(14,165,233,.08); border-radius: 10px; }
.tabs .tab-btn .ico{
  display:inline-flex;width:16px;height:16px;opacity:.9;line-height:1;
  font-size:18px; /* <‚Äî tƒÉng k√≠ch th∆∞·ªõc emoji */
}
.tabs .tab-btn .ico svg{width:16px;height:16px;display:block}

</style>
</head>
<body>
<div class="wrap">
  <div class="frame" id="app-frame">
    <!-- Header -->
    <div class="frame-head">
      <div class="brand">
        <svg class="theme-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        <h1>Toolkit ‚Ä¢ <span class="muted">All-in-one</span></h1>
      </div>
      <button id="themeBtn" class="theme-btn" aria-label="ƒê·ªïi giao di·ªán"><span class="theme-ico" id="themeIcon">üåô</span><span id="themeText">T·ªëi</span></button>
    </div>

    <!-- Tabs -->
    <div class="tabs" id="tabbar">
      <button class="tab-btn active" data-tab="tab-lunisolar">√Çm‚ÄìD∆∞∆°ng L·ªãch</button>
      <button class="tab-btn" data-tab="tab-length">ƒê·ªô d√†i</button>
      <button class="tab-btn" data-tab="tab-mass">Kh·ªëi l∆∞·ª£ng</button>
      <button class="tab-btn" data-tab="tab-volume">Th·ªÉ t√≠ch</button>
      <button class="tab-btn" data-tab="tab-area">Di·ªán t√≠ch</button>
      <button class="tab-btn" data-tab="tab-speed">T·ªëc ƒë·ªô</button>
      <button class="tab-btn" data-tab="tab-pressure">√Åp su·∫•t</button>
      <button class="tab-btn" data-tab="tab-energy">NƒÉng l∆∞·ª£ng</button>
      <button class="tab-btn" data-tab="tab-currency">Ti·ªÅn t·ªá</button>
      <button class="tab-btn" data-tab="tab-temp">Nhi·ªát ƒë·ªô</button>
      <button class="tab-btn" data-tab="tab-bmi">BMI</button>
      <button class="tab-btn" data-tab="tab-percent">Ph·∫ßn trƒÉm</button>
      <button class="tab-btn" data-tab="tab-time">Th·ªùi gian</button>
      <button class="tab-btn" data-tab="tab-day">Ng√†y</button>
      <button class="tab-btn" data-tab="tab-loan">Kho·∫£n vay</button>
      <button class="tab-btn" data-tab="tab-age">Tu·ªïi & Countdown</button>
      <button class="tab-btn" data-tab="tab-workday">Ng√†y l√†m vi·ªác</button>
      <button class="tab-btn" data-tab="tab-bmr">BMR / TDEE</button>
      <button class="tab-btn" data-tab="tab-dob">Sinh nh·∫≠t</button>
      <button class="tab-btn" data-tab="tab-net">T·ªëc ƒë·ªô m·∫°ng</button>
    </div>

    <div class="panel">

      <!-- ========== √Çm‚ÄìD∆∞∆°ng L·ªãch ========== -->
      <section class="tab-panel" id="tab-lunisolar">
        <div class="row" style="justify-content:space-between;gap:16px;margin-bottom:8px">
          <div class="muted">Tra c·ª©u l·ªãch √Çm ‚áÑ D∆∞∆°ng (1900‚Äì2100)</div>
          <div class="row" style="align-items:center">
            <label class="muted" style="margin:0 6px 0 0">M√∫i gi·ªù</label>
            <select id="tzGlobal"><option value="7" selected>GMT+7</option><option value="8">GMT+8</option><option value="0">GMT</option></select>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="title"><span class="dot"></span><h3 style="margin:0">D∆∞∆°ng ‚Üí √Çm</h3></div>
            <div class="row">
              <div><label>Ng√†y</label><input id="sDay" type="number" min="1" max="31" value="1"></div>
              <div><label>Th√°ng</label><input id="sMonth" type="number" min="1" max="12" value="1"></div>
              <div><label>NƒÉm</label><input id="sYear" type="number" min="1900" max="2100" value="2025"></div>
              <div><label>M√∫i gi·ªù</label><select id="tz1"><option value="7" selected>GMT+7</option><option value="8">GMT+8</option><option value="0">GMT</option></select></div>
              <div><button id="btnS2L" class="btn">Chuy·ªÉn ‚Üí</button></div>
            </div>
            <div id="outS2L" class="result"></div>
            <div id="outS2LCC" class="muted" style="margin-top:6px"></div>
          </div>
          <div class="card">
            <div class="title"><span class="dot" style="background:var(--acc-2)"></span><h3 style="margin:0">√Çm ‚Üí D∆∞∆°ng</h3></div>
            <div class="row">
              <div><label>Ng√†y</label><input id="lDay" type="number" min="1" max="30" value="1"></div>
              <div><label>Th√°ng</label><input id="lMonth" type="number" min="1" max="12" value="1"></div>
              <div><label>NƒÉm</label><input id="lYear" type="number" min="1900" max="2100" value="2025"></div>
              <div class="row" style="align-items:center;margin-bottom:8px"><input id="lLeap" type="checkbox" /><label for="lLeap">Th√°ng nhu·∫≠n</label></div>
              <div><label>M√∫i gi·ªù</label><select id="tz2"><option value="7" selected>GMT+7</option><option value="8">GMT+8</option><option value="0">GMT</option></select></div>
              <div><button id="btnL2S" class="btn">‚Üê Chuy·ªÉn</button></div>
            </div>
            <div id="outL2S" class="result"></div>
            <div id="outL2SCC" class="muted" style="margin-top:6px"></div>
          </div>
        </div>
        <div class="foot">V√≠ d·ª• ki·ªÉm ch·ª©ng: 01/01/2026 √¢m ‚Üí 17/02/2026 d∆∞∆°ng (GMT+7).</div>
      </section>

      <!-- ========== ƒê·ªô d√†i ========== -->
      <section class="tab-panel" id="tab-length" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--acc-2)"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi ƒê·ªô d√†i</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="lenAmount" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="lenFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">ƒê·ªïi</label><button id="lenSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="lenTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="lenConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="lenResult" class="result"></div>
        </div>
      </section>

      <!-- ========== Kh·ªëi l∆∞·ª£ng ========== -->
      <section class="tab-panel" id="tab-mass" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#f59e0b"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Kh·ªëi l∆∞·ª£ng</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="massAmount" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="massFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">ƒê·ªïi</label><button id="massSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="massTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="massConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="massResult" class="result"></div>
          <div class="muted" style="margin-top:6px">mg, g, kg, t, oz, lb</div>
        </div>
      </section>

      <!-- ========== Th·ªÉ t√≠ch ========== -->
      <section class="tab-panel" id="tab-volume" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#a78bfa"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Th·ªÉ t√≠ch</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="volAmount" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="volFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">ƒê·ªïi</label><button id="volSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="volTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="volConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="volResult" class="result"></div>
          <div class="muted" style="margin-top:6px">ml, l, m¬≥, in¬≥, ft¬≥, gal (US/UK)</div>
        </div>
      </section>

      <!-- ========== Di·ªán t√≠ch (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-area" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#34d399"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Di·ªán t√≠ch</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="aVal" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="aFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="aSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="aTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="aConv" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="aOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="aHist"></ul></div>
        </div>
      </section>

      <!-- ========== T·ªëc ƒë·ªô (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-speed" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#60a5fa"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi T·ªëc ƒë·ªô</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="spVal" type="number" value="60" step="any"></div>
            <div><label>T·ª´</label><select id="spFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="spSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="spTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="spConv" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="spOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="spHist"></ul></div>
        </div>
      </section>

      <!-- ========== √Åp su·∫•t (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-pressure" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#f59e0b"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi √Åp su·∫•t</h3></div>
        <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="prVal" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="prFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="prSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="prTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="prConv" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="prOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="prHist"></ul></div>
        </div>
      </section>

      <!-- ========== NƒÉng l∆∞·ª£ng (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-energy" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#a78bfa"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi NƒÉng l∆∞·ª£ng / C√¥ng</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="enVal" type="number" value="1" step="any"></div>
            <div><label>T·ª´</label><select id="enFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="enSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="enTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="enConv" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="enOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="enHist"></ul></div>
        </div>
      </section>

      <!-- ========== Ti·ªÅn t·ªá (Realtime) ========== -->
      <section class="tab-panel" id="tab-currency" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#34d399"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Ti·ªÅn t·ªá (ExchangeRate-API)</h3></div>
          <div class="row">
            <div><label>S·ªë ti·ªÅn</label><input id="fxAmount" type="number" value="100" step="any"></div>
            <div><label>T·ª´</label><select id="fxFrom"></select></div>
            <div><label class="muted" style="visibility:hidden">ƒê·ªïi</label><button id="fxSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label><select id="fxTo"></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="fxConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="fxResult" class="result"></div>
          <div class="status" id="fxStatus">ƒêang t·∫£i danh s√°ch m√£ ti·ªÅn t·ªá‚Ä¶</div>
        </div>
      </section>

      <!-- ========== Nhi·ªát ƒë·ªô ========== -->
      <section class="tab-panel" id="tab-temp" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#ef4444"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Nhi·ªát ƒë·ªô</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="tmpVal" type="number" value="100" step="any"></div>
            <div><label>T·ª´</label>
              <select id="tmpFrom"><option value="C" selected>¬∞C</option><option value="F">¬∞F</option><option value="K">K</option></select>
            </div>
            <div><label class="muted" style="visibility:hidden">swap</label><button id="tmpSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label>
              <select id="tmpTo"><option value="C">¬∞C</option><option value="F" selected>¬∞F</option><option value="K">K</option></select>
            </div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="tmpConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="tmpOut" class="result"></div>
        </div>
      </section>

      <!-- ========== BMI ========== -->
      <section class="tab-panel" id="tab-bmi" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#10b981"></span><h3 style="margin:0">T√≠nh ch·ªâ s·ªë BMI</h3></div>
          <div class="row">
            <div><label>Chi·ªÅu cao (cm)</label><input id="bmiH" type="number" value="170" step="any"></div>
            <div><label>C√¢n n·∫∑ng (kg)</label><input id="bmiW" type="number" value="65" step="any"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="bmiCalc" class="btn">T√≠nh BMI</button></div>
          </div>
          <div id="bmiOut" class="result"></div>
          <div class="muted" style="margin-top:6px">Ph√¢n lo·∫°i (WHO): &lt;18.5 G·∫ßy ‚Ä¢ 18.5‚Äì24.9 B√¨nh th∆∞·ªùng ‚Ä¢ 25‚Äì29.9 Th·ª´a c√¢n ‚Ä¢ 30‚Äì34.9 B√©o ph√¨ I ‚Ä¢ 35‚Äì39.9 B√©o ph√¨ II ‚Ä¢ ‚â•40 B√©o ph√¨ III.</div>
        </div>
      </section>

      <!-- ========== Ph·∫ßn trƒÉm ========== -->
      <section class="tab-panel" id="tab-percent" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#06b6d4"></span><h3 style="margin:0">T√≠nh Ph·∫ßn trƒÉm</h3></div>

          <div class="row">
            <div><label>X% c·ªßa N</label><input id="pctX" type="number" value="10" step="any" placeholder="X (%)"></div>
            <div><label>N</label><input id="pctN" type="number" value="200" step="any" placeholder="N"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="pctCalc1" class="btn">T√≠nh</button></div>
          </div>
          <div id="pctOut1" class="result"></div>

          <div class="row" style="margin-top:10px">
            <div><label>TƒÉng/Gi·∫£m N theo X%</label>
              <select id="pctMode"><option value="inc" selected>TƒÉng</option><option value="dec">Gi·∫£m</option></select>
            </div>
            <div><label>N</label><input id="pctBase" type="number" value="200" step="any"></div>
            <div><label>X (%)</label><input id="pctRate" type="number" value="10" step="any"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="pctCalc2" class="btn">T√≠nh</button></div>
          </div>
          <div id="pctOut2" class="result"></div>

          <div class="row" style="margin-top:10px">
            <div><label>A l√† bao nhi√™u % c·ªßa B?</label><input id="pctA" type="number" value="20" step="any" placeholder="A"></div>
            <div><label>B</label><input id="pctB" type="number" value="200" step="any" placeholder="B"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="pctCalc3" class="btn">T√≠nh</button></div>
          </div>
          <div id="pctOut3" class="result"></div>
        </div>
      </section>

      <!-- ========== Th·ªùi gian ========== -->
      <section class="tab-panel" id="tab-time" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#22c55e"></span><h3 style="margin:0">Chuy·ªÉn ƒë·ªïi Th·ªùi gian</h3></div>
          <div class="row">
            <div><label>Gi√° tr·ªã</label><input id="tVal" type="number" value="60" step="any"></div>
            <div><label>T·ª´</label>
              <select id="tFrom"><option value="y">NƒÉm</option><option value="mo">Th√°ng</option><option value="d">Ng√†y</option><option value="h">Gi·ªù</option><option value="m" selected>Ph√∫t</option><option value="s">Gi√¢y</option></select>
            </div>
            <div><label class="muted" style="visibility:hidden">ƒê·ªïi</label><button id="tSwap" class="icon-btn" aria-label="ƒê·ªïi chi·ªÅu">‚áÑ</button></div>
            <div><label>ƒê·∫øn</label>
              <select id="tTo"><option value="y">NƒÉm</option><option value="mo">Th√°ng</option><option value="d">Ng√†y</option><option value="h">Gi·ªù</option><option value="m">Ph√∫t</option><option value="s" selected>Gi√¢y</option></select>
            </div>
            <div>
              <label>K·∫øt qu·∫£</label>
              <div class="radio-row">
                <label><input type="radio" name="tMode" value="dec" checked> Th·∫≠p ph√¢n</label>
                <label><input type="radio" name="tMode" value="split"> Ph√¢n t√°ch (vd: 1 ph√∫t 18 gi√¢y)</label>
              </div>
            </div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="tConvert" class="btn">Quy ƒë·ªïi</button></div>
          </div>
          <div id="tOut" class="result"></div>
          <div class="muted" style="margin-top:6px">Quy ∆∞·ªõc: 1 nƒÉm = 365 ng√†y, 1 th√°ng = 30 ng√†y.</div>
        </div>
      </section>

      <!-- ========== Ng√†y ========== -->
      <section class="tab-panel" id="tab-day" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#f97316"></span><h3 style="margin:0">T√≠nh kho·∫£ng c√°ch gi·ªØa 2 ng√†y</h3></div>
          <div class="row">
            <div><label>Ng√†y b·∫Øt ƒë·∫ßu</label><input id="dFrom" type="date"></div>
            <div><label>Ng√†y k·∫øt th√∫c</label><input id="dTo" type="date"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="dCalc" class="btn">T√≠nh</button></div>
          </div>
          <div id="dOut" class="result"></div>
          <div class="muted" style="margin-top:6px">C√°ch t√≠nh: <b>lo·∫°i tr·ª´</b> (s·ªë ng√†y = k·∫øt th√∫c ‚àí b·∫Øt ƒë·∫ßu).</div>
        </div>
      </section>

<!-- ========== Kho·∫£n vay (m·ªõi) ========== -->
<section class="tab-panel" id="tab-loan" hidden>
  <div class="card">
    <div class="title"><span class="dot" style="background:#22c55e"></span><h3 style="margin:0">T√≠nh kho·∫£n vay (b·∫£ng kh·∫•u hao)</h3></div>

    <div class="row">
      <div>
        <label>Ti·ªÅn vay (VND)</label>
        <input id="loanP" type="number" value="100000000" step="1000">
      </div>

      <div>
        <label>L√£i su·∫•t</label>
        <input id="loanR" type="number" value="10" step="0.01">
      </div>
      <div>
        <label>ƒê∆°n v·ªã l√£i su·∫•t</label>
        <select id="loanRUnit">
          <option value="y" selected>theo NƒÉm</option>
          <option value="mo">theo Th√°ng</option>
          <option value="wk">theo Tu·∫ßn</option>
          <option value="d">theo Ng√†y</option>
        </select>
      </div>

      <div>
        <label>K·ª≥ h·∫°n (s·ªë)</label>
        <input id="loanN" type="number" value="60">
      </div>
      <div>
        <label>ƒê∆°n v·ªã k·ª≥ h·∫°n</label>
        <select id="loanNUnit">
          <option value="mo" selected>Th√°ng</option>
          <option value="wk">Tu·∫ßn</option>
          <option value="d">Ng√†y</option>
        </select>
      </div>

      <div>
        <label class="muted" style="visibility:hidden">_</label>
        <button id="loanCalc" class="btn">T√≠nh</button>
      </div>
    </div>

    <div class="status" id="loanMeta" style="margin-top:4px"></div>
    <div id="loanOut" class="result"></div>
    <div id="loanTableWrap"></div>

    <div class="hist">
      <b>L·ªãch s·ª≠</b>
      <ul id="loanHist"></ul>
    </div>
  </div>
</section>


      <!-- ========== Tu·ªïi & Countdown (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-age" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#ef4444"></span><h3 style="margin:0">Tu·ªïi hi·ªán t·∫°i & ƒê·∫øm ng∆∞·ª£c</h3></div>
          <div class="row">
            <div><label>Ng√†y sinh</label><input id="ageDob" type="date"></div>
            <div><label>M·ªëc ƒë·∫øm (t√πy ch·ªçn)</label><input id="ageTarget" type="date"></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="ageCalc" class="btn">T√≠nh</button></div>
          </div>
          <div id="ageOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="ageHist"></ul></div>
        </div>
      </section>

      <!-- ========== Ng√†y l√†m vi·ªác (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-workday" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#f97316"></span><h3 style="margin:0">T√≠nh s·ªë ng√†y l√†m vi·ªác</h3></div>
          <div class="row">
            <div><label>T·ª´ ng√†y</label><input id="bdFrom" type="date"></div>
            <div><label>ƒê·∫øn ng√†y</label><input id="bdTo" type="date"></div>
            <div class="row" style="align-items:center"><input id="bdWeekend" type="checkbox" checked><label for="bdWeekend">Lo·∫°i tr·ª´ T7/CN</label></div>
          </div>
          <div class="row">
            <div style="min-width:100%"><label>Ng√†y ngh·ªâ/Ng√†y l·ªÖ (dd/mm/yyyy, c√°ch nhau b·ªüi d·∫•u ph·∫©y)</label>
              <textarea id="bdHoliday" placeholder="01/01/2026, 30/04/2026, 01/05/2026"></textarea>
            </div>
          </div>
          <div class="row">
            <div><label class="muted" style="visibility:hidden">_</label><button id="bdCalc" class="btn">T√≠nh</button></div>
          </div>
          <div id="bdOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="bdHist"></ul></div>
        </div>
      </section>

      <!-- ========== BMR/TDEE (m·ªõi) ========== -->
      <section class="tab-panel" id="tab-bmr" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#0ea5e9"></span><h3 style="margin:0">T√≠nh BMR / TDEE</h3></div>
          <div class="row">
            <div><label>Gi·ªõi t√≠nh</label><select id="bmrSex"><option value="m" selected>Nam</option><option value="f">N·ªØ</option></select></div>
            <div><label>Tu·ªïi</label><input id="bmrAge" type="number" value="25"></div>
            <div><label>Cao (cm)</label><input id="bmrH" type="number" value="170" step="any"></div>
            <div><label>N·∫∑ng (kg)</label><input id="bmrW" type="number" value="65" step="any"></div>
            <div><label>Ho·∫°t ƒë·ªông</label>
              <select id="bmrAct">
                <option value="1.2">√çt v·∫≠n ƒë·ªông (1.2)</option>
                <option value="1.375">Nh·∫π (1.375)</option>
                <option value="1.55" selected>V·ª´a (1.55)</option>
                <option value="1.725">Nhi·ªÅu (1.725)</option>
                <option value="1.9">R·∫•t nhi·ªÅu (1.9)</option>
              </select>
            </div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="bmrCalc" class="btn">T√≠nh</button></div>
          </div>
          <div id="bmrOut" class="result"></div>
          <div class="hist"><b>L·ªãch s·ª≠</b><ul id="bmrHist"></ul></div>
        </div>
      </section>

      <!-- ========== Sinh nh·∫≠t ========== -->
      <section class="tab-panel" id="tab-dob" hidden>
        <div class="card">
          <div class="title"><span class="dot" style="background:#eab308"></span><h3 style="margin:0">Th√¥ng tin t·ª´ Ng√†y sinh</h3></div>
          <div class="row">
            <div><label>Ng√†y sinh (D∆∞∆°ng l·ªãch)</label><input id="dobDate" type="date"></div>
            <div><label>M√∫i gi·ªù (cho √¢m l·ªãch)</label><select id="dobTz"><option value="7" selected>GMT+7</option><option value="8">GMT+8</option><option value="0">GMT</option></select></div>
            <div><label class="muted" style="visibility:hidden">_</label><button id="dobCalc" class="btn">Xem th√¥ng tin</button></div>
          </div>
          <div id="dobOut" class="result"></div>
        </div>
      </section>

<!-- ========== T·ªëc ƒë·ªô m·∫°ng ========== -->
<section id="tab-net" class="tab-panel" hidden>
  <div class="card">
    <div class="title">
      <span class="dot" style="background:#10b981"></span>
      <h3 style="margin:0">T√≠nh to√°n t·ªëc ƒë·ªô m·∫°ng / th·ªùi gian t·∫£i</h3>
    </div>

    <!-- H√†ng 1: T·ªëc ƒë·ªô & k√≠ch th∆∞·ªõc t·ªáp -->
    <div class="row">
      <div style="flex:1 1 180px">
        <label>T·ªëc ƒë·ªô ƒë∆∞·ªùng truy·ªÅn</label>
        <div class="row" style="gap:8px">
          <input id="net_speed" type="number" min="0" step="0.01" value="100" style="flex:1">
          <select id="net_speed_unit" style="width:160px">
            <option value="Mbps" selected>Mbps (megabit/s)</option>
            <option value="MBps">MB/s (megabyte/s)</option>
          </select>
        </div>
        <div class="muted small" id="net_speed_hint">100 Mbps ‚âà 12.50 MB/s (∆∞·ªõc t√≠nh)</div>
      </div>

      <div style="flex:1 1 180px">
        <label>K√≠ch th∆∞·ªõc t·ªáp</label>
        <div class="row" style="gap:8px">
          <input id="net_size" type="number" min="0" step="0.01" value="1" style="flex:1">
          <select id="net_size_unit" style="width:160px">
            <option value="MB" selected>MB</option>
            <option value="GB">GB</option>
            <option value="KB">KB</option>
          </select>
        </div>
        <label class="muted small" style="display:flex;align-items:center;gap:8px;margin-top:8px">
          <input id="net_overhead" type="checkbox"> T√≠nh hao h·ª•t giao th·ª©c ~10%
        </label>
      </div>

      <div style="align-self:flex-end">
        <button id="net_calc_btn" class="btn">T√≠nh</button>
      </div>
    </div>

    <!-- K·∫øt qu·∫£ t√≠nh th·ªùi gian -->
    <div class="box small" id="net_result">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y.</div>

    <!-- H√†ng 2: T√≠nh ng∆∞·ª£c theo th·ªùi gian mong mu·ªën -->
    <div class="row" style="margin-top:12px">
      <div style="flex:1 1 260px">
        <label>T√≠nh ng∆∞·ª£c: th·ªùi gian mong mu·ªën</label>
        <div class="row" style="gap:8px">
          <input id="net_target_time" type="number" min="0" step="1" value="60" style="flex:1">
          <select id="net_target_unit" style="width:160px">
            <option value="s" selected>gi√¢y</option>
            <option value="min">ph√∫t</option>
          </select>
        </div>
        <div class="muted small">C·∫ßn t·ªëc ƒë·ªô bao nhi√™u ƒë·ªÉ t·∫£i xong t·ªáp tr√™n trong th·ªùi gian n√†y?</div>
      </div>
      <div style="align-self:flex-end">
        <button id="net_reverse_btn" class="btn secondary">T√≠nh t·ªëc ƒë·ªô c·∫ßn thi·∫øt</button>
      </div>
    </div>

    <!-- ‚úÖ K·∫øt qu·∫£ t√≠nh ng∆∞·ª£c: ƒë·∫∑t NGAY sau kh·ªëi t√≠nh ng∆∞·ª£c -->
    <div class="box small" id="net_reverse_result">‚Äî</div>

    <!-- Ph√¢n c√°ch -->
    <hr class="section-sep">

    <!-- ƒê·ªïi ƒë∆°n v·ªã t·ªëc ƒë·ªô -->
    <div class="title">
      <span class="dot" style="background:#3b82f6"></span>
      <h3 style="margin:0">ƒê·ªïi ƒë∆°n v·ªã t·ªëc ƒë·ªô</h3>
    </div>

    <div class="row">
      <div style="flex:1 1 180px">
        <label>Gi√° tr·ªã</label>
        <input id="rate_val" type="number" step="0.01" min="0" value="100">
      </div>
      <div style="flex:1 1 220px">
        <label>ƒê∆°n v·ªã</label>
        <select id="rate_unit">
          <!-- bit/s -->
          <option value="bps">bps (bit/gi√¢y)</option>
          <option value="Kbps">Kbps (kilobit/s)</option>
          <option value="Mbps" selected>Mbps (megabit/s)</option>
          <option value="Gbps">Gbps (gigabit/s)</option>
          <option value="Tbps">Tbps (terabit/s)</option>
          <!-- byte/s -->
          <option value="Bps">B/s (byte/gi√¢y)</option>
          <option value="KBps">KB/s (kilobyte/s)</option>
          <option value="MBps">MB/s (megabyte/s)</option>
          <option value="GBps">GB/s (gigabyte/s)</option>
          <option value="TBps">TB/s (terabyte/s)</option>
        </select>
      </div>
      <div style="align-self:flex-end;display:flex;gap:8px;flex-wrap:wrap">
        <button id="rate_btn" class="btn">ƒê·ªïi ƒë∆°n v·ªã</button>
        <!-- Tu·ª≥ ch·ªçn: copy t·ª´ "T·ªëc ƒë·ªô ƒë∆∞·ªùng truy·ªÅn" -->
        <!-- <button id="rate_copy_from_speed" class="btn secondary">L·∫•y t·ª´ ‚ÄúT·ªëc ƒë·ªô ƒë∆∞·ªùng truy·ªÅn‚Äù</button> -->
      </div>
    </div>

    <div id="rate_out" class="box small">Nh·∫≠p gi√° tr·ªã & ch·ªçn ƒë∆°n v·ªã, sau ƒë√≥ b·∫•m ‚Äúƒê·ªïi ƒë∆°n v·ªã‚Äù.</div>
  </div>
</section>

    </div>
  </div>
</div>
  
<script>
/* ===== Icons cho tabs (inline SVG) ===== */
const ICONS = {
  default:  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="6"/></svg>`,
  lunisolar:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3A7 7 0 0 0 21 12.79z"/></svg>`,
  length:   `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 17h10M3 12h18M7 7h10"/></svg>`,
  mass:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 18h18l-7-12h-4l-7 12z"/></svg>`,
  volume:   `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7l9-4 9 4v10l-9 4-9-4z"/></svg>`,
  area:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>`,
  speed:    `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9"/><path d="M12 12l6-3"/></svg>`,
  pressure: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="8"/><path d="M12 12V8"/></svg>`,
  energy:   `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h7l-1 8 10-12h-7z"/></svg>`,
  currency: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v22M17 5H9a4 4 0 0 0 0 8h6a4 4 0 1 1 0 8H7"/></svg>`,
  temp:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13V5a2 2 0 1 1 4 0v8a5 5 0 1 1-4 0z"/></svg>`,
  bmi:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="3"/><path d="M5 21a7 7 0 0 1 14 0"/></svg>`,
  percent:  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 5L5 19"/><circle cx="7" cy="7" r="3"/><circle cx="17" cy="17" r="3"/></svg>`,
  time:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>`,
  date:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
  loan:     `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M5 12V7a7 7 0 0 1 14 0v5"/></svg>`,
  age:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="9"/></svg>`,
  bizdays:  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M3 10h18M8 2v4M16 2v4"/></svg>`,
  bmr:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 20h16M4 14h16M4 8h16"/></svg>`,
  dob:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 14a4 4 0 1 0-4-4"/></svg>`,
  default: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>'
};
/* === Override m·ªôt s·ªë icon th√†nh emoji tr·ª±c quan === */
const EMOJI_ICONS = {
  lunisolar: 'üåô',      // √Çm‚ÄìD∆∞∆°ng L·ªãch
  length:    'üìè',      // ƒê·ªô d√†i
  mass:      '‚öñÔ∏è',      // Kh·ªëi l∆∞·ª£ng
  volume:    'üß™',      // Th·ªÉ t√≠ch
  area:      'üó∫Ô∏è',      // Di·ªán t√≠ch
  speed:     'üöÄ',      // T·ªëc ƒë·ªô
  pressure:  'üß≠',      // √Åp su·∫•t
  energy:    '‚ö°',      // NƒÉng l∆∞·ª£ng
  currency:  'üí±',      // Ti·ªÅn t·ªá
  temp:      'üå°Ô∏è',      // Nhi·ªát ƒë·ªô
  bmi:       'üßç',      // BMI
  percent:   'üìà',      // Ph·∫ßn trƒÉm
  time:      '‚è±Ô∏è',      // Th·ªùi gian
  day:       'üìÖ',      // Ng√†y
  loan:      'üí≥',      // Kho·∫£n vay
  age:       'üéØ',      // Tu·ªïi & Countdown
  workday:   'üóìÔ∏è',      // Ng√†y l√†m vi·ªác
  bmr:       'üî•',      // BMR/TDEE
  dob:       'üéÇ',      // Sinh nh·∫≠t
  net:       'üì∂'       // ‚úÖ T·ªëc ƒë·ªô m·∫°ng (tab m·ªõi)
};

function attachTabIcons(){
  const map = {
    // map data-tab ‚Üí key icon (ƒë√£ c√≥ s·∫µn c·ªßa b·∫°n, th√™m d√≤ng cho net)
    'tab-lunisolar':'lunisolar',
    'tab-length':'length',
    'tab-mass':'mass',
    'tab-volume':'volume',
    'tab-area':'area',
    'tab-speed':'speed',
    'tab-pressure':'pressure',
    'tab-energy':'energy',
    'tab-currency':'currency',
    'tab-temp':'temp',
    'tab-bmi':'bmi',
    'tab-percent':'percent',
    'tab-time':'time',
    'tab-day':'day',
    'tab-loan':'loan',
    'tab-age':'age',
    'tab-workday':'workday',
    'tab-bmr':'bmr',
    'tab-dob':'dob',
    'tab-net':'net' // ‚úÖ th√™m d√≤ng n√†y
  };

  const getIconHTML = (key) => {
    if (!key) return ICONS.default;
    // ∆Øu ti√™n emoji n·∫øu c√≥
    if (EMOJI_ICONS[key]) {
      // B·ªçc emoji b·∫±ng span ƒë·ªÉ style ri√™ng
      return `<span class="emj">${EMOJI_ICONS[key]}</span>`;
    }
    // Kh√¥ng c√≥ emoji ‚Üí r∆°i v·ªÅ SVG trong ICONS
    return ICONS[key] || ICONS.default;
  };

  document.querySelectorAll('#tabbar .tab-btn').forEach(btn=>{
    const key = map[btn.dataset.tab];
    if(!key) return;
    if(!btn.querySelector('.ico')){
      const span = document.createElement('span');
      span.className = 'ico';
      span.innerHTML = getIconHTML(key);
      btn.prepend(span);
    }
  });
}

// G·ªåI SAU KHI T·∫†O TABBAR:
document.addEventListener('DOMContentLoaded', attachTabIcons);
</script>

<script>
/* ===== Theme ===== */
(function(){const b=document.getElementById('themeBtn'),i=document.getElementById('themeIcon'),t=document.getElementById('themeText');const saved=localStorage.getItem('theme')||'dark';if(saved==='light')document.documentElement.classList.add('light');function u(){const L=document.documentElement.classList.contains('light');i.textContent=L?'‚òÄÔ∏è':'üåô';t.textContent=L?'S√°ng':'T·ªëi'}u();b.addEventListener('click',()=>{const L=!document.documentElement.classList.contains('light');document.documentElement.classList.toggle('light',L);localStorage.setItem('theme',L?'light':'dark');u();});})();

/* ===== Tabs ===== */
(function(){const btns=[...document.querySelectorAll('.tab-btn')],panels=[...document.querySelectorAll('.tab-panel')];function act(id){btns.forEach(b=>b.classList.toggle('active',b.dataset.tab===id));panels.forEach(p=>p.hidden=(p.id!==id));}btns.forEach(b=>b.addEventListener('click',()=>act(b.dataset.tab)));act('tab-lunisolar');})();

/* ===== Helpers ===== */
const $=id=>document.getElementById(id);
const setResult=(el,html,ok=true)=>el.innerHTML=`<div style="color:${ok?'var(--acc-2)':'#f43f5e'}">${html}</div>`;
function pushHist(key,text,ulId){const k='tool_hist_'+key;let arr=[];try{arr=JSON.parse(localStorage.getItem(k)||'[]')}catch{}arr.unshift(text);arr=arr.slice(0,5);localStorage.setItem(k,JSON.stringify(arr));const ul=$(ulId);if(ul) ul.innerHTML=arr.map(x=>`<li>${x}</li>`).join('');}
function loadHist(key,ulId){const k='tool_hist_'+key;let arr=[];try{arr=JSON.parse(localStorage.getItem(k)||'[]')}catch{}const ul=$(ulId);if(ul) ul.innerHTML=arr.map(x=>`<li>${x}</li>`).join('');}
const VN_DOW=["Ch·ªß Nh·∫≠t","Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Th·ª© NƒÉm","Th·ª© S√°u","Th·ª© B·∫£y"];

/* ===== L·ªãch √Çm‚ÄìD∆∞∆°ng ===== */
const CAN=["Gi√°p","·∫§t","B√≠nh","ƒêinh","M·∫≠u","K·ª∑","Canh","T√¢n","Nh√¢m","Qu√Ω"];
const CHI=["T√Ω","S·ª≠u","D·∫ßn","M√£o","Th√¨n","T·ªµ","Ng·ªç","M√πi","Th√¢n","D·∫≠u","Tu·∫•t","H·ª£i"];
function jdFromDate(d,m,y){const a=Math.floor((14-m)/12);const y2=y+4800-a;const m2=m+12*a-3;return d+Math.floor((153*m2+2)/5)+365*y2+Math.floor(y2/4)-Math.floor(y2/100)+Math.floor(y2/400)-32045;}
function ccDay(d,m,y){const jd=jdFromDate(d,m,y);return CAN[(jd+9)%10]+" "+CHI[(jd+1)%12];}
function ccYear(y){return CAN[(y+6)%10]+" "+CHI[(y+8)%12];}
function ccMonth(lm,ly){const yi=(ly+6)%10;const fs=(yi*2+2)%10;return CAN[(fs+(lm-1))%10]+" "+CHI[(lm+1)%12];}
const lunarInfo=[0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x05ac0,0x0ab60,0x096d5,0x092e0,0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0];
const baseDate=new Date(Date.UTC(1900,0,31));
function lYearDays(y){let s=348,info=lunarInfo[y-1900];for(let i=0x8000;i>0x8;i>>=1){if(info&i)s++;}return s+leapDays(y);}
function leapMonth(y){return lunarInfo[y-1900]&0xf;}
function leapDays(y){if(leapMonth(y))return(lunarInfo[y-1900]&0x10000)?30:29;return 0;}
function monthDays(y,m){return(lunarInfo[y-1900]&(0x10000>>m))?30:29;}
function solarToLunar(dd,mm,yy,tz=7){const dateUTC=Date.UTC(yy,mm-1,dd)+tz*3600*1000;let offset=Math.floor((dateUTC-baseDate.getTime())/86400000);if(offset<0)throw new Error("Ngo√†i ph·∫°m vi (tr∆∞·ªõc 1900-01-31)");let year,month,day;let leap=false;for(year=1900;year<2101&&offset>=0;year++){const days=lYearDays(year);if(offset<days)break;offset-=days;}if(year==2101)throw new Error("Ngo√†i ph·∫°m vi (sau 2100)");const leapM=leapMonth(year);for(month=1;month<=12;month++){let days=monthDays(year,month);if(leapM&&month===leapM+1&&!leap){month--;leap=true;days=leapDays(year);}else{leap=false;}if(offset<days)break;offset-=days;}day=offset+1;return{day,month,year,leap};}
function lunarToSolar(ld,lm,ly,isLeap=false,tz=7){if(ly<1900||ly>2100)throw new Error("NƒÉm ngo√†i ph·∫°m vi");const leapM=leapMonth(ly);if(isLeap&&(leapM===0||lm!==leapM))throw new Error("NƒÉm n√†y kh√¥ng c√≥ th√°ng nhu·∫≠n "+lm);if(ld<1||ld>30)throw new Error("Ng√†y √¢m kh√¥ng h·ª£p l·ªá");let offset=0;for(let i=1;i<lm;i++){offset+=monthDays(ly,i);if(leapM&&i===leapM)offset+=leapDays(ly);}if(isLeap)offset+=monthDays(ly,lm);offset+=(ld-1);let d=new Date(baseDate.getTime());for(let y=1900;y<ly;y++)d.setUTCDate(d.getUTCDate()+lYearDays(y));d.setUTCDate(d.getUTCDate()+offset);const res=new Date(d.getTime()+tz*3600*1000);return{day:res.getUTCDate(),month:res.getUTCMonth()+1,year:res.getUTCFullYear()};}
$('tzGlobal').addEventListener('change',()=>{$('tz1').value=$('tzGlobal').value;$('tz2').value=$('tzGlobal').value;});
$('btnS2L').addEventListener('click',()=>{const d=+$('sDay').value,m=+$('sMonth').value,y=+$('sYear').value,tz=+$('tz1').value;try{const r=solarToLunar(d,m,y,tz);setResult($('outS2L'),`√Çm l·ªãch: <b>${String(r.day).padStart(2,'0')}/${String(r.month).padStart(2,'0')}/${r.year}${r.leap?' (nhu·∫≠n)':''}</b>`);$('outS2LCC').innerHTML=`Ng√†y: <b>${ccDay(d,m,y)}</b> ‚Ä¢ Th√°ng: <b>${ccMonth(r.month,r.year)}</b> ‚Ä¢ NƒÉm: <b>${ccYear(r.year)}</b>`;}catch(e){setResult($('outS2L'),e.message,false);$('outS2LCC').textContent='';}});
$('btnL2S').addEventListener('click',()=>{const d=+$('lDay').value,m=+$('lMonth').value,y=+$('lYear').value,isleap=$('lLeap').checked,tz=+$('tz2').value;try{const r=lunarToSolar(d,m,y,isleap,tz);setResult($('outL2S'),`D∆∞∆°ng l·ªãch: <b>${String(r.day).padStart(2,'0')}/${String(r.month).padStart(2,'0')}/${r.year}</b>`);$('outL2SCC').innerHTML=`Ng√†y: <b>${ccDay(r.day,r.month,r.year)}</b> ‚Ä¢ Th√°ng: <b>${ccMonth(m,y)}</b> ‚Ä¢ NƒÉm: <b>${ccYear(y)}</b>`;}catch(e){setResult($('outL2S'),e.message,false);$('outL2SCC').textContent='';}});

/* ===== Length / Mass / Volume ===== */
const LEN_UNITS={mm:{name:'Milim√©t',toMeter:0.001},cm:{name:'Centim√©t',toMeter:0.01},m:{name:'M√©t',toMeter:1},km:{name:'Kil√¥m√©t',toMeter:1000},in:{name:'Inch',toMeter:0.0254},ft:{name:'Foot',toMeter:0.3048},yd:{name:'Yard',toMeter:0.9144},mi:{name:'D·∫∑m',toMeter:1609.34}};
(function(){const f=$('lenFrom'),t=$('lenTo');for(const k in LEN_UNITS){const label=`${LEN_UNITS[k].name} (${k})`;f.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);t.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);}f.value='m';t.value='cm';function convert(){const amt=parseFloat($('lenAmount').value);if(isNaN(amt))return;const val=(amt*LEN_UNITS[f.value].toMeter)/LEN_UNITS[t.value].toMeter;setResult($('lenResult'),`${amt.toLocaleString('vi-VN')} ${f.value} = <b>${val.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t.value}`);}$('lenConvert').addEventListener('click',convert);$('lenSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];convert();});convert();})();
const MASS_UNITS={mg:{name:'Miligram',toKg:0.000001},g:{name:'Gram',toKg:0.001},kg:{name:'Kilogram',toKg:1},t:{name:'T·∫•n (metric)',toKg:1000},oz:{name:'Ounce',toKg:0.028349523125},lb:{name:'Pound',toKg:0.45359237}};
(function(){const f=$('massFrom'),t=$('massTo');for(const k in MASS_UNITS){const label=`${MASS_UNITS[k].name} (${k})`;f.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);t.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);}f.value='kg';t.value='lb';function convert(){const amt=parseFloat($('massAmount').value);if(isNaN(amt))return;const val=(amt*MASS_UNITS[f.value].toKg)/MASS_UNITS[t.value].toKg;setResult($('massResult'),`${amt.toLocaleString('vi-VN')} ${f.value} = <b>${val.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t.value}`);}$('massConvert').addEventListener('click',convert);$('massSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];convert();});convert();})();
const VOL_UNITS={ml:{name:'Milil√≠t',toM3:0.000001},l:{name:'L√≠t',toM3:0.001},m3:{name:'M√©t kh·ªëi',toM3:1},in3:{name:'Inch kh·ªëi',toM3:0.000016387064},ft3:{name:'Feet kh·ªëi',toM3:0.028316846592},galUS:{name:'Gallon (US)',toM3:0.003785411784},galUK:{name:'Gallon (UK)',toM3:0.00454609}};
(function(){const f=$('volFrom'),t=$('volTo');for(const k in VOL_UNITS){const label=`${VOL_UNITS[k].name} (${k})`;f.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);t.insertAdjacentHTML('beforeend',`<option value="${k}">${label}</option>`);}f.value='l';t.value='ml';function convert(){const amt=parseFloat($('volAmount').value);if(isNaN(amt))return;const val=(amt*VOL_UNITS[f.value].toM3)/VOL_UNITS[t.value].toM3;setResult($('volResult'),`${amt.toLocaleString('vi-VN')} ${f.value} = <b>${val.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t.value}`);}$('volConvert').addEventListener('click',convert);$('volSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];convert();});convert();})();

/* ===== Di·ªán t√≠ch / T·ªëc ƒë·ªô / √Åp su·∫•t / NƒÉng l∆∞·ª£ng ===== */
function buildSelect(sel, map){for(const k in map){sel.insertAdjacentHTML('beforeend', `<option value="${k}">${map[k].name} (${k})</option>`);}}
function convertGeneric(val, fromKey, toKey, baseKey, map){const v=Number(val); if(!isFinite(v)) return null; return v*map[fromKey][baseKey]/map[toKey][baseKey];}
const AREA={mm2:{name:'mm¬≤',m2:1e-6},cm2:{name:'cm¬≤',m2:1e-4},m2:{name:'m¬≤',m2:1},ha:{name:'hecta',m2:10000},km2:{name:'km¬≤',m2:1e6},in2:{name:'in¬≤',m2:0.00064516},ft2:{name:'ft¬≤',m2:0.09290304},yd2:{name:'yd¬≤',m2:0.83612736},acre:{name:'acre',m2:4046.8564224}};
(function(){const f=$('aFrom'), t=$('aTo'); buildSelect(f,AREA); buildSelect(t,AREA); f.value='m2'; t.value='cm2';
  function run(){const out=convertGeneric($('aVal').value,f.value,t.value,'m2',AREA); if(out==null) return; setResult($('aOut'),`${$('aVal').value} ${f.value} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:8})}</b> ${t.value}`); pushHist('area',`${$('aVal').value} ${f.value} ‚Üí ${out.toLocaleString('vi-VN',{maximumFractionDigits:4})} ${t.value}`,'aHist');}
  $('aConv').addEventListener('click',run); $('aSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];}); loadHist('area','aHist'); run();})();
const SPEED={'mps':{name:'m/s',mps:1},'kmph':{name:'km/h',mps:1000/3600},'mph':{name:'mph',mps:1609.344/3600},'knot':{name:'knot',mps:1852/3600}};
(function(){const f=$('spFrom'), t=$('spTo'); for(const k in SPEED){f.insertAdjacentHTML('beforeend',`<option value="${k}">${SPEED[k].name}</option>`); t.insertAdjacentHTML('beforeend',`<option value="${k}">${SPEED[k].name}</option>`);} f.value='kmph'; t.value='mps';
  function run(){const out=convertGeneric($('spVal').value,f.value,t.value,'mps',SPEED); if(out==null) return; setResult($('spOut'),`${$('spVal').value} ${SPEED[f.value].name} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${SPEED[t.value].name}`); pushHist('speed',`${$('spVal').value} ${SPEED[f.value].name} ‚Üí ${out.toLocaleString('vi-VN',{maximumFractionDigits:3})} ${SPEED[t.value].name}`,'spHist');}
  $('spConv').addEventListener('click',run); $('spSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];}); loadHist('speed','spHist'); run();})();
const PRESS={Pa:{name:'Pa',Pa:1},kPa:{name:'kPa',Pa:1000},bar:{name:'bar',Pa:1e5},atm:{name:'atm',Pa:101325},psi:{name:'psi',Pa:6894.757293168},mmHg:{name:'mmHg',Pa:133.3223684211}};
(function(){const f=$('prFrom'), t=$('prTo'); buildSelect(f,PRESS); buildSelect(t,PRESS); f.value='bar'; t.value='psi';
  function run(){const out=convertGeneric($('prVal').value,f.value,t.value,'Pa',PRESS); if(out==null) return; setResult($('prOut'),`${$('prVal').value} ${f.value} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t.value}`); pushHist('press',`${$('prVal').value} ${f.value} ‚Üí ${out.toLocaleString('vi-VN',{maximumFractionDigits:3})} ${t.value}`,'prHist');}
  $('prConv').addEventListener('click',run); $('prSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];}); loadHist('press','prHist'); run();})();
const ENERGY={J:{name:'J',J:1},kJ:{name:'kJ',J:1000},cal:{name:'cal',J:4.184},kcal:{name:'kcal',J:4184},Wh:{name:'Wh',J:3600},kWh:{name:'kWh',J:3.6e6}};
(function(){const f=$('enFrom'), t=$('enTo'); buildSelect(f,ENERGY); buildSelect(t,ENERGY); f.value='kcal'; t.value='kJ';
  function run(){const out=convertGeneric($('enVal').value,f.value,t.value,'J',ENERGY); if(out==null) return; setResult($('enOut'),`${$('enVal').value} ${f.value} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t.value}`); pushHist('energy',`${$('enVal').value} ${f.value} ‚Üí ${out.toLocaleString('vi-VN',{maximumFractionDigits:3})} ${t.value}`,'enHist');}
  $('enConv').addEventListener('click',run); $('enSwap').addEventListener('click',()=>{[f.value,t.value]=[t.value,f.value];}); loadHist('energy','enHist'); run();})();

/* ===== Ti·ªÅn t·ªá (Realtime ExchangeRate-API) ===== */
const FX_API_KEY="87372f0f0f69d53b5958b6c2";
const FX_CACHE_KEY="fx_rates_latest_USD";
const FX_CACHE_TTL_MS=12*60*60*1000;
async function getRates(){
  const cached=localStorage.getItem(FX_CACHE_KEY);
  if(cached){try{const data=JSON.parse(cached);if(Date.now()-data.cachedAt<FX_CACHE_TTL_MS)return data;}catch{}}
  const url=`https://v6.exchangerate-api.com/v6/${FX_API_KEY}/latest/USD`;
  const res=await fetch(url);
  if(!res.ok) throw new Error("HTTP "+res.status);
  const json=await res.json();
  if(json.result!=="success") throw new Error("API error");
  const payload={base:json.base_code,rates:json.conversion_rates,time:json.time_last_update_utc,cachedAt:Date.now()};
  localStorage.setItem(FX_CACHE_KEY,JSON.stringify(payload));
  return payload;
}
(async function initFX(){
  const fromSel=$('fxFrom'),toSel=$('fxTo'),status=$('fxStatus');
  try{
    const data=await getRates();
    const codes=Object.keys(data.rates).sort();
    const opts=codes.map(c=>`<option value="${c}">${c}</option>`).join('');
    fromSel.innerHTML=opts; toSel.innerHTML=opts;
    fromSel.value='USD'; toSel.value='VND';
    status.textContent=`T·ª∑ gi√° n·ªÅn: ${data.base}. C·∫≠p nh·∫≠t: ${data.time}`;
    function convert(){
      const amt=parseFloat($('fxAmount').value); if(isNaN(amt)) return;
      const f=fromSel.value, t=toSel.value;
      const rateF=data.rates[f], rateT=data.rates[t];
      if(rateF==null||rateT==null){ setResult($('fxResult'),'M√£ ti·ªÅn t·ªá kh√¥ng h·ª£p l·ªá.',false); return; }
      const out=amt*(rateT/rateF);
      setResult($('fxResult'), `${amt.toLocaleString('vi-VN')} ${f} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b> ${t}`);
    }
    $('fxConvert').addEventListener('click',convert);
    $('fxSwap').addEventListener('click',()=>{[fromSel.value,toSel.value]=[toSel.value,fromSel.value];});
  }catch(e){ status.textContent='L·ªói t·∫£i t·ª∑ gi√°: '+e.message; }
})();

/* ===== Nhi·ªát ƒë·ªô ===== */
function toK(val,unit){if(unit==='C') return val+273.15; if(unit==='F') return (val-32)*5/9+273.15; return val;}
function fromK(k,unit){if(unit==='C') return k-273.15; if(unit==='F') return (k-273.15)*9/5+32; return k;}
$('tmpSwap').addEventListener('click',()=>{const f=$('tmpFrom'),t=$('tmpTo');[f.value,t.value]=[t.value,f.value];});
$('tmpConvert').addEventListener('click',()=>{
  const v=parseFloat($('tmpVal').value); if(isNaN(v)) return;
  const from=$('tmpFrom').value, to=$('tmpTo').value;
  const out=fromK(toK(v,from),to);
  setResult($('tmpOut'), `${v.toLocaleString('vi-VN')} ¬∞${from} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})} ¬∞${to}</b>`);
});

/* ===== BMI ===== */
function bmiClass(b){
  if(b<18.5) return {label:"G·∫ßy", color:"#60a5fa", tip:"TƒÉng nƒÉng l∆∞·ª£ng, th√™m ƒë·∫°m & t·∫≠p s·ª©c m·∫°nh."};
  if(b<25)   return {label:"B√¨nh th∆∞·ªùng", color:"#10b981", tip:"Duy tr√¨ ch·∫ø ƒë·ªô ƒÉn c√¢n b·∫±ng & v·∫≠n ƒë·ªông ƒë·ªÅu."};
  if(b<30)   return {label:"Th·ª´a c√¢n", color:"#f59e0b", tip:"TƒÉng v·∫≠n ƒë·ªông, ki·ªÉm so√°t kh·∫©u ph·∫ßn & ƒë∆∞·ªùng."};
  if(b<35)   return {label:"B√©o ph√¨ I", color:"#f97316", tip:"T·∫°o th√¢m h·ª•t calo nh·∫π, theo d√µi ti·∫øn ƒë·ªô."};
  if(b<40)   return {label:"B√©o ph√¨ II", color:"#ef4444", tip:"Tham kh·∫£o chuy√™n gia dinh d∆∞·ª°ng/b√°c sƒ©."};
  return {label:"B√©o ph√¨ III", color:"#dc2626", tip:"C·∫ßn can thi·ªáp y t·∫ø & k·∫ø ho·∫°ch d√†i h·∫°n."};
}
$('bmiCalc').addEventListener('click',()=>{
  const h=parseFloat($('bmiH').value), w=parseFloat($('bmiW').value);
  if(isNaN(h)||isNaN(w)||h<=0||w<=0){ setResult($('bmiOut'),'Vui l√≤ng nh·∫≠p chi·ªÅu cao/c√¢n n·∫∑ng h·ª£p l·ªá.',false); return; }
  const m=h/100; const bmi=w/(m*m);
  const c=bmiClass(bmi);
  setResult($('bmiOut'), `BMI = <b style="color:${c.color}">${bmi.toFixed(1)}</b> ‚Ä¢ Ph√¢n lo·∫°i: <b style="color:${c.color}">${c.label}</b><br><span class="muted">G·ª£i √Ω:</span> ${c.tip}`);
});

/* ===== Ph·∫ßn trƒÉm ===== */
$('pctCalc1').addEventListener('click',()=>{
  const x=parseFloat($('pctX').value), n=parseFloat($('pctN').value);
  if(isNaN(x)||isNaN(n)) return;
  const v=n*x/100;
  setResult($('pctOut1'), `${x}% c·ªßa ${n} = <b>${v.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b>`);
});
$('pctCalc2').addEventListener('click',()=>{
  const mode=$('pctMode').value, n=parseFloat($('pctBase').value), r=parseFloat($('pctRate').value);
  if(isNaN(n)||isNaN(r)) return;
  const v = mode==='inc' ? n*(1+r/100) : n*(1-r/100);
  setResult($('pctOut2'), `${mode==='inc'?'TƒÉng':'Gi·∫£m'} ${n} theo ${r}% = <b>${v.toLocaleString('vi-VN',{maximumFractionDigits:6})}</b>`);
});
$('pctCalc3').addEventListener('click',()=>{
  const a=parseFloat($('pctA').value), b=parseFloat($('pctB').value);
  if(isNaN(a)||isNaN(b)||b===0){ setResult($('pctOut3'),'Vui l√≤ng nh·∫≠p A/B h·ª£p l·ªá (B ‚â† 0).',false); return; }
  const p=a/b*100;
  setResult($('pctOut3'), `${a} l√† <b>${p.toLocaleString('vi-VN',{maximumFractionDigits:6})}%</b> c·ªßa ${b}`);
});

/* ===== Th·ªùi gian ===== */
const T_SECONDS={y:365*24*3600, mo:30*24*3600, d:24*3600, h:3600, m:60, s:1};
const T_LABEL={y:"nƒÉm",mo:"th√°ng",d:"ng√†y",h:"gi·ªù",m:"ph√∫t",s:"gi√¢y"};
const ORDER=["y","mo","d","h","m","s"];
$('tSwap').addEventListener('click',()=>{const f=$('tFrom'),t=$('tTo');[f.value,t.value]=[t.value,f.value];});
$('tConvert').addEventListener('click',()=>{
  const val=parseFloat($('tVal').value); if(isNaN(val)) return;
  const from=$('tFrom').value, to=$('tTo').value;
  const mode=[...document.querySelectorAll('input[name="tMode"]')].find(r=>r.checked).value;
  const totalSec=val*T_SECONDS[from], toSec=T_SECONDS[to];
  if(mode==="dec"){
    const out=totalSec/toSec;
    setResult($('tOut'), `${val.toLocaleString('vi-VN')} ${T_LABEL[from]} = <b>${out.toLocaleString('vi-VN',{maximumFractionDigits:6})} ${T_LABEL[to]}</b>`);
  }else{
    const q=Math.floor(totalSec/toSec); const remSec=totalSec-q*toSec;
    const idx=ORDER.indexOf(to); const small=(idx>=0&&idx<ORDER.length-1)?ORDER[idx+1]:null;
    if(!small||remSec===0){ setResult($('tOut'), `${val} ${T_LABEL[from]} = <b>${q} ${T_LABEL[to]}</b>`); }
    else{
      const smallVal=Math.floor(remSec/T_SECONDS[small]);
      setResult($('tOut'), `${val} ${T_LABEL[from]} = <b>${q} ${T_LABEL[to]}</b> <b>${smallVal} ${T_LABEL[small]}</b>`);
    }
  }
});

/* ===== Ng√†y ===== */
function toDateLocal(s){if(!s)return null;const [Y,M,D]=s.split('-').map(Number);return new Date(Y,M-1,D);}
function fmtVN(d){const dd=String(d.getDate()).padStart(2,'0');const mm=String(d.getMonth()+1).padStart(2,'0');const yy=d.getFullYear();return `${dd}/${mm}/${yy}`;}
$('dCalc').addEventListener('click',()=>{
  const s=toDateLocal($('dFrom').value), e=toDateLocal($('dTo').value);
  if(!s||!e){ setResult($('dOut'),'Vui l√≤ng ch·ªçn ƒë·ªß 2 ng√†y.',false); return; }
  const ONE=24*3600*1000; const diff=Math.round((e-s)/ONE);
  setResult($('dOut'), `
    Kho·∫£ng th·ªùi gian t·ª´ <b>${fmtVN(s)}</b> ƒë·∫øn <b>${fmtVN(e)}</b> l√†: <b>${diff}</b> ng√†y<br>
    Ng√†y b·∫Øt ƒë·∫ßu (${fmtVN(s)}): <b>${VN_DOW[s.getDay()]}</b><br>
    Ng√†y k·∫øt th√∫c (${fmtVN(e)}): <b>${VN_DOW[e.getDay()]}</b>
  `);
});
(function(){const ds=new Date(2025,9,29), de=new Date(2025,10,8);
  $('dFrom').value=`${ds.getFullYear()}-${String(ds.getMonth()+1).padStart(2,'0')}-${String(ds.getDate()).padStart(2,'0')}`;
  $('dTo').value  =`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,'0')}-${String(de.getDate()).padStart(2,'0')}`;
})();

/* ===== Kho·∫£n vay (h·ªó tr·ª£ ng√†y/tu·∫ßn/th√°ng) ===== */
const PERIODS_PER_YEAR = { mo:12, wk:52, d:365 };
const UNIT_LABEL = { mo:'th√°ng', wk:'tu·∫ßn', d:'ng√†y' };

/** PMT theo chu k·ª≥ thanh to√°n (ƒë√£ quy v·ªÅ l√£i su·∫•t/chu k·ª≥ rP v√† s·ªë k·ª≥ n) */
function pmtByPeriod(P, rP, n){
  return rP === 0 ? P / n : P * rP / (1 - Math.pow(1 + rP, -n));
}

/** L·∫≠p b·∫£ng kh·∫•u hao theo chu k·ª≥ ƒë√£ ch·ªçn */
function amortizeByPeriod(P, rP, n){
  const pay = pmtByPeriod(P, rP, n);
  let bal = P;
  const rows = [];
  for (let k = 1; k <= n; k++) {
    const interest = bal * rP;
    const principal = Math.min(pay - interest, bal);
    bal = Math.max(0, bal - principal);
    rows.push({ k, payment: pay, interest, principal, balance: bal });
  }
  return { payment: pay, rows };
}

/** Quy ƒë·ªïi l√£i su·∫•t nh·∫≠p v√†o v·ªÅ l√£i su·∫•t nƒÉm (d·∫°ng th·∫≠p ph√¢n) */
function toAnnualRate(rateValue, rateUnit){
  const r = rateValue / 100;     // 10% -> 0.10
  if (rateUnit === 'y')  return r;
  if (rateUnit === 'mo') return r * 12;
  if (rateUnit === 'wk') return r * 52;
  if (rateUnit === 'd')  return r * 365;
  return r;
}

/** Quy ƒë·ªïi s·ªë k·ª≥ h·∫°n v·ªÅ s·ªë NƒÇM */
function termToYears(term, unit){
  if (unit === 'mo') return term / 12;
  if (unit === 'wk') return term / 52;
  if (unit === 'd')  return term / 365;
  return term; // d·ª± ph√≤ng
}

function fmtVN0(x){ return x.toLocaleString('vi-VN', { maximumFractionDigits:0 }); }

document.getElementById('loanCalc').addEventListener('click', () => {
  const P       = +document.getElementById('loanP').value;
  const rateVal = +document.getElementById('loanR').value;
  const rateUni = document.getElementById('loanRUnit').value; // y/mo/wk/d
  const termVal = +document.getElementById('loanN').value;
  const termUni = document.getElementById('loanNUnit').value; // mo/wk/d

  if (!(P > 0 && termVal > 0)) {
    setResult(document.getElementById('loanOut'), 'Vui l√≤ng nh·∫≠p ti·ªÅn vay & k·ª≥ h·∫°n h·ª£p l·ªá.', false);
    return;
  }

  // Quy ƒë·ªïi v·ªÅ ‚Äúchu k·ª≥ thanh to√°n‚Äù = ƒë√∫ng theo ƒë∆°n v·ªã k·ª≥ h·∫°n b·∫°n ch·ªçn
  const periodsPerYear = PERIODS_PER_YEAR[termUni];
  const annualRate     = toAnnualRate(rateVal, rateUni);
  const rP             = annualRate / periodsPerYear;                 // l√£i su·∫•t m·ªói k·ª≥
  const years          = termToYears(termVal, termUni);
  const n              = Math.round(years * periodsPerYear);          // s·ªë k·ª≥ thanh to√°n

  // Kh·∫•u hao
  const { payment, rows } = amortizeByPeriod(P, rP, n);

  // T·ªïng h·ª£p
  const totI = rows.reduce((s,r)=>s+r.interest,0);
  const totP = rows.reduce((s,r)=>s+r.principal,0);

  // Meta m√¥ t·∫£
  document.getElementById('loanMeta').textContent =
    `Chu k·ª≥ thanh to√°n: m·ªói ${UNIT_LABEL[termUni]} ‚Ä¢ L√£i/chu k·ª≥ ‚âà ${(rP*100).toFixed(4)}% ‚Ä¢ S·ªë k·ª≥: ${n}`;

  setResult(
    document.getElementById('loanOut'),
    `Kho·∫£n tr·∫£ m·ªói ${UNIT_LABEL[termUni]}: <b>${fmtVN0(payment)} VND</b><br>
     T·ªïng g·ªëc tr·∫£: <b>${fmtVN0(totP)}</b> ‚Ä¢ T·ªïng l√£i: <b class="warn">${fmtVN0(totI)}</b> ‚Ä¢ T·ªïng chi: <b>${fmtVN0(totP+totI)}</b>`
  );

  pushHist('loan',
    `P=${fmtVN0(P)} | r=${rateVal}%/${rateUni} | n=${termVal}${termUni} ‚Üí pay‚âà${fmtVN0(payment)}`,
    'loanHist'
  );

  // B·∫£ng kh·∫•u hao (r√∫t g·ªçn + n√∫t m·ªü r·ªông)
  const wrap = document.getElementById('loanTableWrap');
  const head = `<table><thead><tr>
    <th>K·ª≥</th><th>Tr·∫£</th><th>L√£i</th><th>G·ªëc</th><th>D∆∞ n·ª£</th>
  </tr></thead><tbody>`;
  const row = r => `<tr>
    <td>${r.k}</td>
    <td>${fmtVN0(r.payment)}</td>
    <td>${fmtVN0(r.interest)}</td>
    <td>${fmtVN0(r.principal)}</td>
    <td>${fmtVN0(r.balance)}</td>
  </tr>`;

  const first = rows.slice(0, 3).map(row).join('');
  const last  = rows.slice(-3).map(row).join('');
  wrap.innerHTML = head +
    first +
    `<tr><td colspan="5" style="text-align:center;color:var(--muted)">...</td></tr>` +
    last +
    `</tbody></table>
     <div style="margin-top:8px">
       <button id="loanExpand" class="btn">Hi·ªÉn th·ªã to√†n b·ªô b·∫£ng (${rows.length} d√≤ng)</button>
     </div>`;

  document.getElementById('loanExpand').onclick = () => {
    wrap.innerHTML = head + rows.map(row).join('') + `</tbody></table>`;
  };
});

loadHist('loan','loanHist');

/* ===== Tu·ªïi & Countdown ===== */
function diffYMD(a,b){let y=b.getFullYear()-a.getFullYear();let m=b.getMonth()-a.getMonth();let d=b.getDate()-a.getDate();if(d<0){ m--; const prev=new Date(b.getFullYear(),b.getMonth(),0); d+=prev.getDate(); } if(m<0){ y--; m+=12; } return {y,m,d};}
$('ageCalc').addEventListener('click',()=>{
  const s=$('ageDob').value, t=$('ageTarget').value;
  if(!s){ setResult($('ageOut'),'Vui l√≤ng ch·ªçn ng√†y sinh.',false); return; }
  const dob=new Date(s+'T00:00:00'); const now=new Date();
  const age=diffYMD(dob, now);
  let txt=`Tu·ªïi hi·ªán t·∫°i: <b>${age.y} nƒÉm ${age.m} th√°ng ${age.d} ng√†y</b>`;
  if(t){
    const tgt=new Date(t+'T00:00:00'); const msDay=86400000;
    const days=Math.round((tgt-now)/msDay);
    txt+=`<br>ƒê·∫øm ng∆∞·ª£c t·ªõi <b>${t}</b>: <b>${days}</b> ng√†y`;
  }else{
    let next=new Date(now.getFullYear(), dob.getMonth(), dob.getDate());
    if(next<now) next.setFullYear(next.getFullYear()+1);
    const days=Math.round((next-now)/86400000);
    txt+=`<br>C√≤n <b>${days}</b> ng√†y t·ªõi sinh nh·∫≠t ti·∫øp theo (${next.toLocaleDateString('vi-VN')})`;
  }
  setResult($('ageOut'),txt);
  pushHist('age',`${s}${t?` ‚Üí target ${t}`:''}`,'ageHist');
});
(function(){const ex=new Date(1998,8,14);$('ageDob').value=`${ex.getFullYear()}-${String(ex.getMonth()+1).padStart(2,'0')}-${String(ex.getDate()).padStart(2,'0')}`;})(); 
loadHist('age','ageHist');

/* ===== Ng√†y l√†m vi·ªác ===== */
function parseVNDate(str){const [d,m,y]=str.split('/').map(Number); if(!d||!m||!y) return null; return new Date(y,m-1,d);}
$('bdCalc').addEventListener('click',()=>{
  const f=$('bdFrom').value, to=$('bdTo').value; if(!f||!to){ setResult($('bdOut'),'Ch·ªçn ƒë·ªß 2 ng√†y.',false); return; }
  const a=new Date(f+'T00:00:00'), b=new Date(to+'T00:00:00');
  if(b<a){ setResult($('bdOut'),'Kho·∫£ng ng√†y kh√¥ng h·ª£p l·ªá (ƒë·∫øn < t·ª´).',false); return; }
  const exclWeekend=$('bdWeekend').checked;
  const raw=$('bdHoliday').value.trim();
  const holidays = raw? raw.split(',').map(s=>parseVNDate(s.trim())).filter(Boolean).map(d=>d.toDateString()) : [];
  let cnt=0, work=0, weekend=0, holiday=0;
  const dayMs=86400000; for(let t=a.getTime(); t<=b.getTime(); t+=dayMs){ cnt++; const d=new Date(t);
    const isWeekend=(d.getDay()===0||d.getDay()===6); const isHoliday=holidays.includes(d.toDateString());
    if(isWeekend){ weekend++; if(exclWeekend) continue; }
    if(isHoliday){ holiday++; continue; }
    work++;
  }
  setResult($('bdOut'),`T·ªïng ng√†y: <b>${cnt}</b> ‚Ä¢ Ng√†y l√†m vi·ªác: <b>${work}</b> ‚Ä¢ Cu·ªëi tu·∫ßn: <span class="warn"><b>${weekend}</b></span> ‚Ä¢ Ngh·ªâ/l·ªÖ lo·∫°i tr·ª´: <span class="bad"><b>${holiday}</b></span>`);
  pushHist('bizdays',`${f} ‚Üí ${to} | work=${work}`,'bdHist');
});
loadHist('bizdays','bdHist');

/* ===== BMR/TDEE ===== */
function calcBMR(sex, w, h, age){return sex==='m' ? (10*w + 6.25*h - 5*age + 5) : (10*w + 6.25*h - 5*age - 161);}
$('bmrCalc').addEventListener('click',()=>{
  const sex=$('bmrSex').value, age=+$('bmrAge').value, h=+$('bmrH').value, w=+$('bmrW').value, act=+$('bmrAct').value;
  if(!(age>0&&h>0&&w>0)){ setResult($('bmrOut'),'Vui l√≤ng nh·∫≠p d·ªØ li·ªáu h·ª£p l·ªá.',false); return; }
  const bmr=calcBMR(sex,w,h,age); const tdee=bmr*act;
  setResult($('bmrOut'),`
    BMR (Mifflin‚ÄìSt Jeor): <b>${Math.round(bmr).toLocaleString('vi-VN')}</b> kcal/ng√†y<br>
    TDEE (m·ª©c hi·ªán t·∫°i): <b>${Math.round(tdee).toLocaleString('vi-VN')}</b> kcal/ng√†y<br>
    G·ª£i √Ω: Gi·∫£m ~500 kcal ‚Üí <b>${Math.round(tdee-500).toLocaleString('vi-VN')}</b> ‚Ä¢ TƒÉng ~300 kcal ‚Üí <b>${Math.round(tdee+300).toLocaleString('vi-VN')}</b>
  `);
  pushHist('bmr',`${sex==='m'?'Nam':'N·ªØ'} ${w}kg/${h}cm/${age}t ‚Ä¢ TDEE‚âà${Math.round(tdee)}`,'bmrHist');
});
loadHist('bmr','bmrHist');

/* ===== Western Zodiac + DOB ===== */
function westernZodiac(month, day){
  const inRange=(m,d, sM,sD, eM,eD)=> sM<eM ? ((m>sM&&m<eM)||(m===sM&&d>=sD)||(m===eM&&d<=eD))
                                         : ((m> sM||m< eM)||(m===sM&&d>=sD)||(m===eM&&d<=eD));
  const Z=[["Ma K·∫øt",[12,22],[1,19]],["B·∫£o B√¨nh",[1,20],[2,18]],["Song Ng∆∞",[2,19],[3,20]],["B·∫°ch D∆∞∆°ng",[3,21],[4,19]],
           ["Kim Ng∆∞u",[4,20],[5,20]],["Song T·ª≠",[5,21],[6,20]],["C·ª± Gi·∫£i",[6,21],[7,22]],["S∆∞ T·ª≠",[7,23],[8,22]],
           ["X·ª≠ N·ªØ",[8,23],[9,22]],["Thi√™n B√¨nh",[9,23],[10,22]],["B·ªç C·∫°p",[10,23],[11,21]],["Nh√¢n M√£",[11,22],[12,21]]];
  for(const [name,s,e] of Z){ if(inRange(month,day,s[0],s[1],e[0],e[1])) return name; } return "Ma K·∫øt";
}
function zodiacAnimal(chi){const map={T√Ω:"Chu·ªôt",S·ª≠u:"Tr√¢u",D·∫ßn:"H·ªï",M√£o:"M√®o",Th√¨n:"R·ªìng",T·ªµ:"R·∫Øn",Ng·ªç:"Ng·ª±a",M√πi:"D√™",Th√¢n:"Kh·ªâ",D·∫≠u:"G√†",Tu·∫•t:"Ch√≥",H·ª£i:"L·ª£n"};return map[chi]||chi;}
$('dobCalc').addEventListener('click',()=>{
  const s=$('dobDate').value; const tz=+$('dobTz').value||7;
  const d=toDateLocal(s);
  if(!d){ setResult($('dobOut'),'Vui l√≤ng ch·ªçn ng√†y sinh.',false); return; }
  const dl={dd:d.getDate(), mm:d.getMonth()+1, yy:d.getFullYear()};
  let lunar, err=null;
  try{ lunar=solarToLunar(dl.dd,dl.mm,dl.yy,tz); }catch(e){ err=e.message; }
  const wz = westernZodiac(dl.mm, dl.dd);
  let yearCC='', monthCC='', dayCC='', giap='';
  if(!err && lunar){
    yearCC = ccYear(lunar.year);
    monthCC = ccMonth(lunar.month, lunar.year);
    dayCC   = ccDay(dl.dd, dl.mm, dl.yy);
    giap = zodiacAnimal(yearCC.split(' ').slice(-1)[0]);
  }
  const lunarText = err ? `Kh√¥ng ƒë·ªïi ƒë∆∞·ª£c √¢m l·ªãch (${err})` :
    `√Çm l·ªãch: <b>${String(lunar.day).padStart(2,'0')}/${String(lunar.month).padStart(2,'0')}/${lunar.year}${lunar.leap?' (nhu·∫≠n)':''}</b>
     ‚Ä¢ Can‚ÄìChi ng√†y: <b>${dayCC}</b> ‚Ä¢ th√°ng: <b>${monthCC}</b> ‚Ä¢ nƒÉm: <b>${yearCC}</b> (${giap})`;
  const out = `
    Ng√†y sinh (d∆∞∆°ng): <b>${String(dl.dd).padStart(2,'0')}/${String(dl.mm).padStart(2,'0')}/${dl.yy}</b><br>
    Cung Ho√†ng ƒë·∫°o (T√¢y): <b>${wz}</b><br>
    ${lunarText}
  `;
  setResult($('dobOut'), out);
});
/* ==== T·ªëc ƒë·ªô m·∫°ng: t√≠nh to√°n ==== */
(function NetSpeedModule(){
  const $ = (s)=>document.querySelector(s);

  const speedInp   = $('#net_speed');
  const speedUnit  = $('#net_speed_unit');
  const sizeInp    = $('#net_size');
  const sizeUnit   = $('#net_size_unit');
  const overheadCb = $('#net_overhead');
  const btnCalc    = $('#net_calc_btn');
  const out        = $('#net_result');

  const targetTime = $('#net_target_time');
  const targetUnit = $('#net_target_unit');
  const btnReverse = $('#net_reverse_btn');
  const outReverse = $('#net_reverse_result');
  const hintSpeed  = $('#net_speed_hint');

  // Helpers
  const KB = 1024, MB = 1024*1024, GB = 1024*1024*1024;
  function toBytes(value, unit){
    if(unit==='KB') return value*KB;
    if(unit==='MB') return value*MB;
    if(unit==='GB') return value*GB;
    return value;
  }
  function toMbps(value, unit){ // value in Mbps or MB/s ‚Üí Mbps
    return (unit==='MBps') ? (value*8) : value;
  }
  function toMBps(mbps){ return mbps/8; }

  function fmtTime(sec){
    if(sec < 60) return `${sec.toFixed(1)} gi√¢y`;
    const m = Math.floor(sec/60);
    const s = Math.round(sec%60);
    return `${m} ph√∫t ${String(s).padStart(2,'0')} gi√¢y`;
  }

  function updateSpeedHint(){
    const v = parseFloat(speedInp.value || '0');
    const u = speedUnit.value;
    let mbps = toMbps(v, u);
    hintSpeed.textContent = `${v||0} ${u} ‚âà ${toMBps(mbps).toFixed(2)} MB/s (∆∞·ªõc t√≠nh)`;
  }

  function calc(){
    const v = parseFloat(speedInp.value || '0');
    const u = speedUnit.value;
    const mbps = toMbps(v, u); // Mbps
    const fileBytes = toBytes(parseFloat(sizeInp.value || '0'), sizeUnit.value);
    if(!mbps || !fileBytes){ out.textContent = 'Nh·∫≠p t·ªëc ƒë·ªô & k√≠ch th∆∞·ªõc h·ª£p l·ªá.'; return; }

    // Option overhead
    const effectiveMbps = overheadCb.checked ? mbps*0.9 : mbps;

    // Th·ªùi gian t·∫£i (s) = (fileBytes * 8) / (Mbps * 1e6)
    const sec = (fileBytes * 8) / (effectiveMbps * 1e6);

    out.innerHTML =
      `‚Ä¢ T·ªëc ƒë·ªô hi·ªáu d·ª•ng: <b>${effectiveMbps.toFixed(2)} Mbps</b> (${toMBps(effectiveMbps).toFixed(2)} MB/s)`+
      `<br>‚Ä¢ Th·ªùi gian t·∫£i ∆∞·ªõc t√≠nh: <b>${fmtTime(sec)}</b>`;
  }

  function reverseCalc(){
    const fileBytes = toBytes(parseFloat(sizeInp.value || '0'), sizeUnit.value);
    if(!fileBytes){ outReverse.textContent = 'Nh·∫≠p k√≠ch th∆∞·ªõc t·ªáp h·ª£p l·ªá.'; return; }
    let t = parseFloat(targetTime.value || '0');
    if(!t || t<=0){ outReverse.textContent = 'Nh·∫≠p th·ªùi gian mong mu·ªën h·ª£p l·ªá.'; return; }
    if(targetUnit.value==='min') t *= 60; // ph√∫t ‚Üí gi√¢y

    // Mbps c·∫ßn = (fileBytes * 8) / (t * 1e6)
    let need = (fileBytes * 8) / (t * 1e6);
    // N·∫øu ƒëang tick overhead, tƒÉng th√™m ~11.11% ƒë·ªÉ b√π (v√¨ 90% hi·ªáu d·ª•ng ‚Üí chia 0.9)
    if(overheadCb.checked) need /= 0.9;

    outReverse.innerHTML =
      `‚Ä¢ C·∫ßn t·ªëi thi·ªÉu: <b>${need.toFixed(2)} Mbps</b> (${toMBps(need).toFixed(2)} MB/s) ƒë·ªÉ t·∫£i xong trong ${fmtTime(t)}.`;
  }

  // Bind
  ['input','change'].forEach(ev=>{
    speedInp.addEventListener(ev, updateSpeedHint);
    speedUnit.addEventListener(ev, updateSpeedHint);
  });
  btnCalc.addEventListener('click', calc);
  btnReverse.addEventListener('click', reverseCalc);

  // Init
  updateSpeedHint();
})();
/* ==== ƒê·ªïi ƒë∆°n v·ªã t·ªëc ƒë·ªô (Mbps ‚áÑ MB/s ‚Ä¶) ==== */
(function NetRateConverter(){
  const $  = s => document.querySelector(s);
  const v  = $('#rate_val');
  const u  = $('#rate_unit');
  const bt = $('#rate_btn');
  const out= $('#rate_out');

  // B·∫£ng quy ƒë·ªïi v·ªÅ "bps" (bit/gi√¢y).
  // L∆∞u √Ω: 1 B/s = 8 bps; d√πng SI (1 K = 1e3, 1 M = 1e6, ‚Ä¶)
  const FACTOR_TO_BPS = {
    bps:  1,
    Kbps: 1e3,
    Mbps: 1e6,
    Gbps: 1e9,
    Tbps: 1e12,
    Bps:  8,
    KBps: 8e3,
    MBps: 8e6,
    GBps: 8e9,
    TBps: 8e12
  };

  const LABELS = {
    bps:'bps (bit/s)', Kbps:'Kbps', Mbps:'Mbps', Gbps:'Gbps', Tbps:'Tbps',
    Bps:'B/s (byte/s)', KBps:'KB/s', MBps:'MB/s', GBps:'GB/s', TBps:'TB/s'
  };

  function fmt(n){ return Number(n).toLocaleString(undefined,{maximumFractionDigits:4}); }

  function convert(){
    const val = parseFloat(v.value||'0');
    const unit= u.value;
    if(!val || val<0){ out.textContent = 'Nh·∫≠p gi√° tr·ªã h·ª£p l·ªá.'; return; }

    // ƒë·ªïi sang bps
    const bps = val * FACTOR_TO_BPS[unit];

    // sinh ra t·∫•t c·∫£ c√°c ƒë∆°n v·ªã kh√°c
    const entries = Object.keys(FACTOR_TO_BPS).map(k=>{
      const value = bps / FACTOR_TO_BPS[k];
      return `<li><b>${fmt(value)}</b> ${LABELS[k]}</li>`;
    }).join('');

    out.innerHTML =
      `<div class="muted">K·∫øt qu·∫£ quy ƒë·ªïi t∆∞∆°ng ƒë∆∞∆°ng:</div>`+
      `<ul style="margin:8px 0 0 18px;line-height:1.7">${entries}</ul>`;
  }

  bt.addEventListener('click', convert);
  v.addEventListener('keydown', e => { if(e.key==='Enter') convert(); });

  // G·ª£i √Ω: t·ª± ƒë·ªông ch·∫°y n·∫øu b·∫°n mu·ªën c·∫≠p nh·∫≠t t·ª©c th·ªùi khi ƒë·ªïi unit
  u.addEventListener('change', convert);
})();

</script>
</body>
</html>

